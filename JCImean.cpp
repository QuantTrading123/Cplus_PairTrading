#include <iostream>
using namespace std;
#define ARMA_DONT_USE_WRAPPER
#include <armadillo>

//#include "Johanson.hpp"
double Johansen_mean(const arma::mat& alpha, const arma::mat& beta, const vector<arma::mat>& mu, vector<arma::mat> mod_gamma, int lag_p, int rank = 1) {
    std::cout << "======== Johanson mean========" << std::endl;
    int NumDim = 2;
    arma::mat sumgamma = arma::zeros(NumDim, NumDim);
    cout << ">>>><<<<<" << endl;
    for (int i = 0; i < lag_p; ++i) {
        sumgamma += mod_gamma[i];
    }
    cout << ">>>><<<<<" << endl;
    arma::mat GAMMA = arma::eye(NumDim, NumDim) - sumgamma;
    arma::mat alpha_orthogonal = alpha;
    arma::mat alpha_t = alpha.t();
    cout << ">>>><<<<<" << endl;
    alpha_orthogonal(1, 0) = -(alpha_t(0, 0) * alpha_orthogonal(0, 0)) / alpha_t(0, 1);
    cout << ">>>><<<<<" << endl;
    alpha_orthogonal = alpha_orthogonal / arma::accu(arma::abs(alpha_orthogonal));
    cout << ">>>><<<<<" << endl;
    arma::mat beta_orthogonal = beta;
    cout << ">>>><<<<<" << endl;
    arma::mat beta_t = beta.t();
    cout << ">>>><<<<<" << endl;
    beta_orthogonal(1, 0) = -(beta_t(0, 0) * beta_orthogonal(0, 0)) / beta_t(0, 1);
    beta_orthogonal = beta_orthogonal / arma::accu(arma::abs(beta_orthogonal));
    arma::mat temp1 = (alpha_orthogonal.t() * GAMMA * beta_orthogonal).i();
    cout << ">>>><<<<<" << endl;
    arma::mat C = beta_orthogonal * temp1 * alpha_orthogonal.t();
    arma::mat temp2 = (alpha.t() * alpha).i();
    arma::mat alpha_hat = alpha * temp2;
    arma::mat temp3 = GAMMA * C - arma::eye(NumDim, NumDim);
    temp3.print("temp3");
    cout << ">>>><<<<<" << endl;
    arma::mat C0 = mu[0];
    arma::mat C1 = mu[2];
    arma::mat D0 = mu[1];
    arma::mat D1 = mu[3];
    cout << ">>>>stanlaaaa<<<<<" << endl;
    alpha.print("alpha");
    C0.print("C0");
    arma::mat wrong1 = alpha * C0;
    wrong1.print("wrong1");

    D0.print("DO");
    arma::mat wrong2 = alpha * C0 + C1;
    wrong2.print("wrong2");
    C0 = alpha * C0 + C1 + alpha * D0 + D1;
    cout << ">>>>stanlaaaa<<<<<" << endl;
    arma::mat Ct = alpha * D0 + D1;
    cout << ">>>>stanlaaaa<<<<<" << endl;
    arma::mat expect_intercept = alpha_hat.t() * temp3 * C0;
    cout << ">>>>stanlaaaa<<<<<" << endl;
    arma::mat expect_slope = alpha_hat.t() * temp3 * Ct;
    expect_intercept.raw_print("mula");
    expect_slope.print("slopla");
}

// template <class T>
// void printArray2D(T&& list, int row, int col) {
//     for (int i = 0; i < row; i++) {
//         for (int j = 0; j < col; j++) {
//             cout << list{i}{j} << " ";
//         }
//         cout << endl;
//     }
// }
int main() {
    arma::mat ut = {{-1.24922125e-03, 2.26971600e-03},
                    {2.20896560e-03, 3.65529153e-03},
                    {4.72045504e-04, 4.25531707e-03},
                    {1.30122515e-03, 3.50027011e-03},
                    {-2.35707920e-05, 1.24522312e-02},
                    {3.14119309e-04, 3.83764688e-03},
                    {-5.87853497e-05, -5.39474126e-03},
                    {7.29739107e-04, -2.63886834e-04},
                    {8.85272357e-04, 1.46531387e-03},
                    {9.97750939e-04, -3.41960549e-04},
                    {-1.17018892e-03, -1.55364014e-03},
                    {8.05525622e-04, -6.94826275e-04},
                    {-2.94911385e-04, 3.31445354e-04},
                    {-7.84165248e-04, -5.55650368e-05},
                    {-1.46093991e-03, -3.31109673e-03},
                    {5.39608367e-04, 2.34475224e-03},
                    {-7.32667690e-04, -1.99011454e-03},
                    {3.71614817e-05, 3.18326645e-03},
                    {-2.24289239e-03, -3.12509262e-03},
                    {-5.56132200e-04, 6.67882314e-03},
                    {3.86492917e-04, -3.54983200e-04},
                    {-1.33340457e-04, -2.43305485e-03},
                    {-1.29712356e-04, -1.28520202e-03},
                    {4.08521609e-04, -3.96482297e-04},
                    {2.82608555e-04, 2.25911660e-03},
                    {4.62232784e-04, 6.26816496e-04},
                    {4.39421897e-04, 3.61319163e-03},
                    {1.07624347e-03, -1.84539046e-03},
                    {1.89050315e-03, 2.40784107e-03},
                    {-7.61878972e-04, -7.09923682e-04},
                    {1.09513743e-03, 1.56547518e-03},
                    {-6.54012078e-04, 4.94271491e-04},
                    {7.45978942e-04, 4.04589702e-03},
                    {3.88790785e-04, 9.57635350e-04},
                    {1.22050019e-03, 2.13518797e-03},
                    {1.57291540e-04, 2.86800496e-03},
                    {4.14745052e-04, -4.16504318e-04},
                    {3.19030173e-04, 3.96523304e-03},
                    {2.06062515e-03, 4.73690756e-03},
                    {1.86410805e-03, 1.87851996e-03},
                    {2.21856024e-03, 2.57183948e-03},
                    {-6.20245405e-04, 2.38385488e-03},
                    {-7.18209228e-04, -5.02777138e-04},
                    {1.55219041e-04, -1.64889693e-03},
                    {1.21577382e-03, -7.23656041e-04},
                    {5.79166464e-04, 4.58646211e-04},
                    {5.46132860e-04, -1.27715826e-05},
                    {5.63702147e-04, 1.16692791e-03},
                    {-3.75946920e-04, 1.88679359e-03},
                    {-1.11936095e-03, -7.00143332e-04},
                    {8.01189683e-04, -7.65281955e-03},
                    {-1.48727607e-03, 9.79581325e-04},
                    {5.58863849e-04, 1.42857092e-03},
                    {-1.47698388e-04, 9.16585932e-04},
                    {-9.92044984e-05, -1.07646894e-04},
                    {6.58869420e-04, -1.81793195e-04},
                    {-3.38370191e-04, 2.70581606e-03},
                    {-6.74519763e-04, -2.44626323e-03},
                    {1.00293047e-04, 1.16360564e-03},
                    {-1.70839792e-03, -6.80833105e-03},
                    {-2.76595290e-03, -7.40721562e-04},
                    {-1.78638815e-03, -1.22220170e-03},
                    {-3.99611820e-04, 1.34041188e-03},
                    {-1.40023697e-03, -2.93280610e-04},
                    {-5.06206308e-04, 2.10149706e-03},
                    {-2.78931300e-04, -9.36969420e-04},
                    {-1.79329195e-03, -3.25578467e-03},
                    {1.30222678e-03, -7.29599346e-05},
                    {-1.12019384e-03, -5.80012982e-03},
                    {5.72525337e-04, 9.40986713e-04},
                    {-2.37577497e-04, 1.27906647e-03},
                    {-1.80099907e-04, -3.83146542e-03},
                    {8.57704557e-04, 1.69741940e-03},
                    {-1.74778125e-03, -4.73889480e-03},
                    {1.26780051e-03, 3.41970447e-03},
                    {-7.38787117e-04, 3.78320091e-04},
                    {4.84392611e-04, -1.63944242e-03},
                    {-6.63097758e-04, -2.18234147e-03},
                    {-1.87775422e-03, -9.99338683e-04},
                    {-1.04111945e-03, -3.50427557e-03},
                    {-1.08639946e-03, -8.30158125e-04},
                    {-6.37197876e-04, -1.98791532e-03},
                    {-7.26460412e-04, -4.06751755e-03},
                    {1.03071889e-03, 5.34606804e-04},
                    {-6.31437628e-04, -4.06946903e-03},
                    {-4.24584218e-04, -5.15829659e-03},
                    {3.78383085e-04, -2.02599310e-03},
                    {1.20891357e-03, 2.07103912e-03},
                    {1.58997778e-04, -4.43923192e-04},
                    {1.32845540e-03, 5.95301812e-03},
                    {-1.19566301e-03, -2.85234403e-03},
                    {1.67197803e-03, -9.65003449e-03},
                    {-1.82545956e-04, 2.60349105e-03},
                    {2.22253578e-04, -6.14004970e-04},
                    {6.47643686e-04, 3.74676047e-03},
                    {8.52406813e-04, 1.09014606e-03},
                    {1.78792390e-03, 5.19718266e-03},
                    {3.57751399e-04, -1.23880621e-03},
                    {3.29929462e-04, -7.55795052e-03},
                    {-2.70197194e-04, 3.27622370e-03},
                    {1.04348535e-03, 1.15848874e-03},
                    {8.57535514e-04, 1.28650419e-03},
                    {2.82801606e-04, -1.84798799e-04},
                    {-1.05119062e-03, -2.07750270e-03},
                    {-9.04441671e-04, -2.11347781e-03},
                    {8.47543971e-05, -1.08446208e-03},
                    {-4.60421754e-04, -1.64449739e-03},
                    {-7.00443400e-04, -2.47999215e-03},
                    {-3.44155327e-04, 7.52231357e-04},
                    {-2.51808612e-03, -3.23276979e-03},
                    {-3.17156026e-04, 2.44565811e-03},
                    {6.12210797e-04, -1.76626903e-03},
                    {2.34851792e-04, 8.73776037e-04},
                    {-8.64391215e-04, -3.32388501e-03},
                    {1.22970302e-03, 1.65408473e-03},
                    {-8.79646707e-04, -1.94480939e-03},
                    {-9.70080967e-04, -1.00559578e-03},
                    {5.36414782e-04, 5.38831596e-04}};
    arma::mat alpha = arma::colvec({0.70281575, -0.29718425});
    arma::mat beta = arma::colvec({-0.8280386, 0.1719614});
    arma::mat gamma;  //= {{0.30294791, -0.06315603}, {0.58598012, -0.07522277}};
    vector<arma::mat> mu;
    arma::mat C0 = {5.94050301};
    arma::mat D0 = {0};
    arma::mat C1 = arma::colvec({0.00013095, 0.00030969});
    arma::mat D1 = arma::colvec({0.0, 0.0});
    // arma::mat D1(2, 1);
    // D1.fill(0.0);
    mu.push_back(C0);
    mu.push_back(D0);
    mu.push_back(C1);
    mu.push_back(D1);

    vector<arma::mat> mod_gamma;
    mod_gamma.push_back(gamma);

    // printArray2D(ut, 119, 2);
    // arma::mat a(&alpha{0}{0}, sizeof(alpha) / sizeof(alpha{0}), sizeof(alpha{0}) / sizeof(alpha{0}{0}));
    // arma::mat b(&beta{0}{0}, sizeof(beta) / sizeof(beta{0}), sizeof(beta{0}) / sizeof(beta{0}{0}));
    // arma::mat u(&ut{0}{0}, sizeof(ut) / sizeof(ut{0}), sizeof(ut{0}) / sizeof(ut{0}{0}), true, true);
    // // double gamma{};
    Johansen_mean(alpha, beta, mu, mod_gamma, 0);
}
